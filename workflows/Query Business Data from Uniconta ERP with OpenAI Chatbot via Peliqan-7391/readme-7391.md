Query Business Data from Uniconta ERP with OpenAI Chatbot via Peliqan

https://n8nworkflows.xyz/workflows/query-business-data-from-uniconta-erp-with-openai-chatbot-via-peliqan-7391


# Query Business Data from Uniconta ERP with OpenAI Chatbot via Peliqan

---

### 1. Workflow Overview

This workflow, titled **"Peliqan AI Agent Uniconta ERP"**, is designed to create an AI-powered chatbot interface that enables users to query business data from the **Uniconta ERP** system using natural language. It leverages OpenAI’s language models combined with a specialized data warehouse caching tool, **Peliqan**, which stores synchronized Uniconta data for fast SQL querying. The AI agent converts user questions into SQL queries, executes them on Peliqan, and returns interpreted results as chatbot responses.

The workflow is logically divided into the following blocks:

- **1.1 Input Reception:** Receiving chat messages from users via a webhook.
- **1.2 AI Processing & Query Generation:** Using an AI agent to convert natural language queries into SQL commands, referencing the Uniconta data model.
- **1.3 SQL Query Execution:** Running the generated SQL queries against the Peliqan data warehouse.
- **1.4 Memory and Language Model Integration:** Managing conversational memory and linking OpenAI’s chat model to the agent.
- **1.5 Output Delivery:** Returning AI-generated answers back to the user chat interface.

---

### 2. Block-by-Block Analysis

#### 2.1 Input Reception

- **Overview:** Listens for incoming chat messages from users to trigger the workflow.
- **Nodes Involved:**  
  - `When chat message received`
- **Node Details:**

  - **When chat message received**  
    - Type: Chat Trigger (Langchain)  
    - Role: Entry point webhook that captures user chat input publicly.  
    - Configuration: Public webhook with default options to receive chat messages.  
    - Inputs: External chat client via webhook.  
    - Outputs: Passes message data to the AI agent node.  
    - Edge Cases: Failure to receive messages if webhook URL changes or network issues; unauthorized access if public webhook is not secured; malformed chat input.  
    - Version: 1.1

#### 2.2 AI Processing & Query Generation

- **Overview:** Converts the user’s natural language question into an SQL query targeting Uniconta ERP data stored in Peliqan, using a detailed system message to guide the AI.
- **Nodes Involved:**  
  - `AI Agent`
- **Node Details:**

  - **AI Agent**  
    - Type: Langchain Agent  
    - Role: Core AI logic that interprets queries and formulates SQL commands.  
    - Configuration:  
      - System Message includes detailed Uniconta data model (tables and columns) for accurate Text-to-SQL translation.  
      - Defines Peliqan’s "Execute SQL" tool to run queries and receive results under key `"detail"`.  
      - Always outputs data to next node.  
    - Inputs: Receives chat messages from the trigger node.  
    - Outputs: Sends SQL query strings to Peliqan execution node and integrates memory & language model outputs.  
    - Key Expressions: Uses an AI tool reference `SQL_Query__View_` for SQL execution results.  
    - Edge Cases: Incorrect or ambiguous user queries causing invalid SQL; API key or permission issues with Peliqan; AI model hallucination or incomplete data model; exceeding token limits.  
    - Version: 1.6

#### 2.3 SQL Query Execution

- **Overview:** Executes the SQL queries generated by the AI agent against the cached Uniconta data warehouse in Peliqan.
- **Nodes Involved:**  
  - `Execute an SQL query via Peliqan`
- **Node Details:**

  - **Execute an SQL query via Peliqan**  
    - Type: Peliqan Tool Node  
    - Role: Executes SQL queries on Peliqan data warehouse and returns results.  
    - Configuration:  
      - Operation: Execute SQL query  
      - Query: Dynamically populated from AI agent’s output using expression `${fromAI('SQL_Query', '', 'string')}`  
      - Connection: Uses stored Peliqan API credentials.  
    - Inputs: Receives SQL query text from AI Agent node as a tool call.  
    - Outputs: Returns query results to AI Agent for interpretation.  
    - Edge Cases: API key expiration or invalid credentials; SQL syntax errors; network or service downtime; query timeouts; empty or large result sets.  
    - Version: 1  

#### 2.4 Memory and Language Model Integration

- **Overview:** Maintains conversational context and links the AI agent with OpenAI's chat model to generate coherent, contextual responses.
- **Nodes Involved:**  
  - `OpenAI Chat Model`  
  - `Simple Memory`
- **Node Details:**

  - **OpenAI Chat Model**  
    - Type: Langchain OpenAI Chat Language Model  
    - Role: Provides underlying language generation capabilities for the AI Agent.  
    - Configuration: Uses OpenAI API credentials linked to a developer account.  
    - Inputs: Connected as language model input to AI Agent.  
    - Outputs: Passes generated text back to AI Agent.  
    - Edge Cases: API rate limits; invalid API keys; network failures; model errors.  
    - Version: 1

  - **Simple Memory**  
    - Type: Langchain Memory Buffer Window  
    - Role: Stores recent conversational history to maintain context.  
    - Configuration: Default window-based memory buffer, no custom parameters.  
    - Inputs: Receives memory updates from AI Agent.  
    - Outputs: Feeds memory context to AI Agent for better response generation.  
    - Edge Cases: Memory overflow or loss on workflow restart; context confusion with complex conversations.  
    - Version: 1.3

#### 2.5 Output Delivery and Notes

- **Overview:** While the workflow nodes explicitly show message reception and processing, the response delivery is handled implicitly via the Langchain chat trigger and AI agent integration; sticky notes provide setup instructions and contextual information.
- **Nodes Involved:**  
  - Various sticky notes for documentation and user guidance.
- **Node Details:**

  - **Sticky Note5 (Introduction and Setup)**  
    - Role: Provides detailed user instructions, project description, setup steps for Peliqan and Uniconta, and contact info.  
    - Content Highlights: Explains the use case, data sync concept, and how to configure the system message with specific data models.  
    - Positioning: Visible at workflow start for operator reference.

  - **Sticky Note4 (Environment Variable Warning)**  
    - Role: Warns about environment variable `N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=True` needed to enable Peliqan SQL execution.  
    - Important for security and operational setup.

  - **Sticky Note1, Sticky Note2, Sticky Note (Tools for AI Agent: SQL)**  
    - Role: Organizational labels clarifying logical workflow sections: AI Chatbot, Brain, and SQL Tools.

---

### 3. Summary Table

| Node Name                     | Node Type                                   | Functional Role                                      | Input Node(s)               | Output Node(s)                   | Sticky Note                                                                                                          |
|-------------------------------|---------------------------------------------|-----------------------------------------------------|-----------------------------|---------------------------------|----------------------------------------------------------------------------------------------------------------------|
| When chat message received     | Langchain Chat Trigger                       | Receive incoming chat messages (entry point)         | —                           | AI Agent                       | See Sticky Note1 for AI Chatbot overview                                                                             |
| AI Agent                      | Langchain Agent                             | Convert NL query to SQL, coordinate AI processing    | When chat message received   | Execute SQL via Peliqan, Simple Memory, OpenAI Chat Model | Contains full Uniconta data model in system message for SQL generation; see Sticky Note2 for "Brain" context         |
| Execute an SQL query via Peliqan | Peliqan Tool Node                         | Execute SQL query on Peliqan data warehouse           | AI Agent (as tool)           | AI Agent (receives query result) | Requires env variable `N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=True` as per Sticky Note4                           |
| OpenAI Chat Model             | Langchain OpenAI Chat Language Model       | Language model for AI Agent                            | —                           | AI Agent                       | Uses OpenAI credentials "OpenAi account dev@peliqan.io"                                                              |
| Simple Memory                 | Langchain Memory Buffer Window             | Maintain conversational memory context                | AI Agent                    | AI Agent                       |                                                                                                                      |
| Sticky Note5                 | Sticky Note                                | Workflow introduction, setup instructions             | —                           | —                               | Detailed introduction and setup instructions with links and contact info                                            |
| Sticky Note4                 | Sticky Note                                | Env variable warning                                   | —                           | —                               | Notes environment variable for Peliqan tool usage                                                                   |
| Sticky Note1                 | Sticky Note                                | AI Chatbot section label                               | —                           | —                               |                                                                                                                      |
| Sticky Note2                 | Sticky Note                                | Brain section label                                    | —                           | —                               |                                                                                                                      |
| Sticky Note (Tools for AI Agent: SQL) | Sticky Note                        | Tools section label (SQL)                              | —                           | —                               |                                                                                                                      |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Chat Trigger Node:**  
   - Add node: **Langchain Chat Trigger** (`When chat message received`)  
   - Set webhook to public (default options)  
   - Position near start of canvas.

2. **Create AI Agent Node:**  
   - Add node: **Langchain Agent** (`AI Agent`)  
   - Paste the System Message describing the Uniconta ERP data model (tables and columns) into the system message field. This message guides the AI to translate natural language into SQL queries.  
   - Configure the AI Agent to use a tool named "Execute SQL" to send SQL queries and receive results (key `"detail"`).  
   - Connect output of Chat Trigger node to AI Agent input.  
   - Enable "Always Output Data" and set type version to 1.6 or higher.

3. **Create Peliqan SQL Execution Node:**  
   - Add node: **Peliqan Tool Node** (`Execute an SQL query via Peliqan`)  
   - Operation: Execute SQL query  
   - Query parameter: Use expression to get SQL from AI Agent tool input: `={{ $fromAI('SQL_Query', '', 'string') }}`  
   - Select your Peliqan data warehouse connection (requires Peliqan API credentials).  
   - Connect AI Agent’s tool output to this node’s input.  
   - Ensure environment variable `N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=True` is set in your n8n environment.

4. **Create OpenAI Chat Model Node:**  
   - Add node: **Langchain OpenAI Chat Model** (`OpenAI Chat Model`)  
   - Configure with OpenAI API credentials (e.g., your OpenAI developer account key).  
   - Connect this node as the language model input to the AI Agent node.

5. **Create Memory Node:**  
   - Add node: **Langchain Memory Buffer Window** (`Simple Memory`)  
   - Use default settings.  
   - Connect AI Agent memory output to this node and connect this node’s output back into AI Agent memory input, enabling context retention.

6. **Connect Workflow:**  
   - From Chat Trigger → AI Agent  
   - From AI Agent (tool output) → Peliqan SQL Execution  
   - From Peliqan SQL Execution → AI Agent (to feed results back)  
   - AI Agent connects to OpenAI Chat Model and Simple Memory nodes as needed.

7. **Add Sticky Notes:** (Optional but recommended)  
   - Add notes describing workflow purpose, setup instructions, environment variable requirements, and section labels for clarity.

8. **Test and Activate:**  
   - Test the webhook by sending a chat message.  
   - Verify the AI agent generates SQL, executes it on Peliqan, and returns interpreted results.  
   - Monitor for errors such as API key issues, invalid queries, or timeout.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | Context or Link                                                            |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
| End-to-end demo showing an AI agent answering questions on internal business data from Uniconta ERP, using Peliqan.io as a data warehouse cache with one-click ELT synchronization. AI agent uses Text-to-SQL to convert natural language to SQL executed on Peliqan data. Users can query products, stock, accounting, etc.                                                                                                                                                                                                                                                                                                                         | Sticky Note5 introduction and description                                 |
| Setup instructions include signing up at https://peliqan.io, connecting Uniconta ERP via API key to Peliqan, copying Peliqan API key to n8n credentials, selecting the proper data warehouse, and optionally customizing the AI agent’s system message with your specific Uniconta datamodel.                                                                                                                                                                                                                                                                                                                                                           | Sticky Note5 setup steps and Peliqan documentation link                  |
| Important environment variable `N8N_COMMUNITY_PACKAGES_ALLOW_TOOL_USAGE=True` must be set to allow execution of Peliqan SQL query tools inside n8n workflows. This is a security and operational setting.                                                                                                                                                                                                                                                                                                                                                                                                                                           | Sticky Note4 warning                                                      |
| For support or questions, contact Peliqan at support@peliqan.io.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Provided in Sticky Note5                                                   |
| Workflow uses OpenAI API credentials linked to `dev@peliqan.io` for language model operations. Ensure you have valid API keys and appropriate usage quotas.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | Node credential detail                                                    |
| The system message within the AI Agent includes a comprehensive Uniconta ERP data schema (tables and fields) to enable accurate SQL query generation. Users should update this with their own data model if customized.                                                                                                                                                                                                                                                                                                                                                                                                                              | AI Agent system message content                                           |
| Visit peliqan.io/n8n for additional resources and examples related to integrating Peliqan with n8n for AI agents.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Sticky Note5 mention of URL                                              |

---

Disclaimer: The provided text is derived exclusively from an automated workflow created using n8n, an integration and automation tool. This processing strictly adheres to current content policies and contains no illegal, offensive, or protected elements. All data handled is legal and public.

---