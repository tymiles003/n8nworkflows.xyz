Query PostgreSQL Database with Natural Language Using Groq AI Chatbot

https://n8nworkflows.xyz/workflows/query-postgresql-database-with-natural-language-using-groq-ai-chatbot-3680


# Query PostgreSQL Database with Natural Language Using Groq AI Chatbot

### 1. Workflow Overview

This workflow enables querying a **PostgreSQL** database using natural language via a chatbot interface. It integrates n8nâ€™s AI Agent capabilities with PostgreSQL to dynamically generate and execute SQL queries based on user chat inputs. The workflow maintains conversation context, retrieves database schema metadata to inform query generation, executes queries, and returns AI-generated natural language responses.

Logical blocks:

- **1.1 Input Reception:** Captures incoming chat messages to trigger the workflow.
- **1.2 Conversation Memory:** Stores recent chat history to provide context for AI responses.
- **1.3 AI Agent Core:** Orchestrates the conversation, generates SQL queries dynamically, and manages external tool calls.
- **1.4 Database Interactions:** Retrieves schema information and executes SQL queries on PostgreSQL.
- **1.5 Language Model Processing:** Uses the Groq Chat Model to generate natural language responses based on AI Agent output.
- **1.6 Guidance & Customization:** Provides sticky notes with instructions and tips for workflow adaptation.

---

### 2. Block-by-Block Analysis

#### 1.1 Input Reception

- **Overview:**  
  Listens for incoming chat messages via webhook and triggers the workflow immediately upon message reception.

- **Nodes Involved:**  
  - When chat message received

- **Node Details:**  
  - **When chat message received**  
    - Type: Chat Trigger node (`@n8n/n8n-nodes-langchain.chatTrigger`)  
    - Role: Entry point; listens for chat messages to start processing  
    - Configuration: Default webhook with no additional parameters; webhook ID assigned for external integration  
    - Inputs: None (trigger node)  
    - Outputs: Connects to AI Agent node  
    - Version: 1.1  
    - Edge cases: Webhook connectivity issues, malformed incoming messages, or missing required chat fields may cause failures.

#### 1.2 Conversation Memory

- **Overview:**  
  Maintains a sliding window of the last 10 chat interactions to provide conversation context for the AI Agent.

- **Nodes Involved:**  
  - Chat History

- **Node Details:**  
  - **Chat History**  
    - Type: Memory Buffer Window node (`@n8n/n8n-nodes-langchain.memoryBufferWindow`)  
    - Role: Stores and supplies recent conversation history to AI Agent  
    - Configuration: Default settings (typically retains last 10 messages)  
    - Inputs: None (used as memory source)  
    - Outputs: Connected to AI Agent as `ai_memory` input  
    - Version: 1.3  
    - Edge cases: Memory overflow if context window is too large; loss of context if window size is too small.

#### 1.3 AI Agent Core

- **Overview:**  
  Central orchestrator that receives chat input and conversation history, generates dynamic PostgreSQL SQL queries, and manages calls to external tools (PostgreSQL nodes).

- **Nodes Involved:**  
  - AI Agent

- **Node Details:**  
  - **AI Agent**  
    - Type: Agent node (`@n8n/n8n-nodes-langchain.agent`)  
    - Role: Processes chat input and memory, generates SQL queries, and calls external tools (PostgreSQL nodes) dynamically  
    - Configuration: Default agent setup with tools linked (PostgreSQL nodes), language model set to Groq Chat Model node  
    - Inputs:  
      - Main input from "When chat message received" (chat input)  
      - Memory input from "Chat History" (conversation context)  
    - Outputs:  
      - Calls PostgreSQL nodes as AI tools  
      - Sends prompt to Groq Chat Model for final response generation  
    - Version: 1.7  
    - Edge cases: Expression evaluation errors, SQL injection risks if prompt is not sanitized, failure to generate valid SQL, tool call failures (e.g., database connection issues).  
    - Sub-workflow: None

#### 1.4 Database Interactions

- **Overview:**  
  Executes SQL queries generated by the AI Agent and retrieves database schema and table definitions to inform query generation.

- **Nodes Involved:**  
  - PostgreSQL (Query Execution)  
  - PostgreSQL Schema (Schema Retrieval)  
  - PostgreSQL Definition (Table Definition Retrieval)

- **Node Details:**  
  - **PostgreSQL (Query Execution)**  
    - Type: PostgreSQL node (`n8n-nodes-base.postgresTool`)  
    - Role: Executes dynamic SQL queries generated by AI Agent  
    - Configuration: Uses expression `{{$node["AI Agent"].json.sql_query}}` to get SQL query from AI Agent output  
    - Inputs: Called as AI tool by AI Agent  
    - Outputs: Query results returned to AI Agent  
    - Version: 2.5  
    - Edge cases: SQL syntax errors, connection/authentication failures, query timeouts, empty or malformed query strings.

  - **PostgreSQL Schema (Schema Retrieval)**  
    - Type: PostgreSQL node (`n8n-nodes-base.postgresTool`)  
    - Role: Retrieves list of tables from PostgreSQL `public` schema excluding system schemas  
    - Configuration: Executes query like `SELECT table_name FROM information_schema.tables WHERE table_schema = 'public';`  
    - Inputs: Called as AI tool by AI Agent  
    - Outputs: Table list data returned to AI Agent  
    - Version: 2.5  
    - Edge cases: Permission issues, empty schema, connection failures.

  - **PostgreSQL Definition (Table Definition Retrieval)**  
    - Type: PostgreSQL node (`n8n-nodes-base.postgresTool`)  
    - Role: Fetches metadata (columns, data types) for a specific table dynamically specified by AI Agent  
    - Configuration: Executes query similar to `SELECT column_name, data_type FROM information_schema.columns WHERE table_name = '{{dynamic_table_name}}' AND table_schema = 'public';`  
    - Inputs: Called as AI tool by AI Agent  
    - Outputs: Table column definitions returned to AI Agent  
    - Version: 2.5  
    - Edge cases: Missing or invalid table name, permission issues, connection errors.

#### 1.5 Language Model Processing

- **Overview:**  
  Processes the combined input (chat message, context, and database query results) to generate the final natural language response.

- **Nodes Involved:**  
  - Groq Chat Model

- **Node Details:**  
  - **Groq Chat Model**  
    - Type: Language Model Chat node (`@n8n/n8n-nodes-langchain.lmChatGroq`)  
    - Role: Generates natural language responses from AI Agentâ€™s consolidated input  
    - Configuration: Uses Groq Chat API credentials; default parameters (e.g., max tokens, temperature) can be adjusted  
    - Inputs: Connected as AI language model by AI Agent  
    - Outputs: Final chat response delivered to user  
    - Version: 1  
    - Edge cases: API authentication failures, rate limits, response timeouts, malformed prompts.

#### 1.6 Guidance & Customization

- **Overview:**  
  Provides instructional sticky notes to guide users on model switching, token limits, SQL query customization, and context window adjustments.

- **Nodes Involved:**  
  - Sticky Note1  
  - Sticky Note2  
  - Sticky Note3  
  - Sticky Note

- **Node Details:**  
  - **Sticky Notes**  
    - Type: Sticky Note nodes (`n8n-nodes-base.stickyNote`)  
    - Role: Display guidance and tips for workflow customization  
    - Configuration: Content fields contain instructions or links (some empty in provided JSON, but typically filled with guidance)  
    - Inputs/Outputs: None (informational only)  
    - Version: 1  
    - Edge cases: None (non-executable nodes)

---

### 3. Summary Table

| Node Name               | Node Type                          | Functional Role                     | Input Node(s)               | Output Node(s)             | Sticky Note                                                                                      |
|-------------------------|----------------------------------|-----------------------------------|-----------------------------|----------------------------|-------------------------------------------------------------------------------------------------|
| When chat message received | Chat Trigger (`chatTrigger`)      | Entry point; listens for chat messages | None                        | AI Agent                   |                                                                                                 |
| Chat History            | Memory Buffer Window (`memoryBufferWindow`) | Stores last 10 chat interactions for context | None                        | AI Agent                   |                                                                                                 |
| AI Agent                | Agent (`agent`)                   | Orchestrates conversation, generates SQL, calls tools | When chat message received, Chat History | PostgreSQL, PostgreSQL Schema, PostgreSQL Definition, Groq Chat Model |                                                                                                 |
| PostgreSQL             | PostgreSQL Tool (`postgresTool`)  | Executes dynamic SQL queries       | AI Agent (as AI tool)        | AI Agent                   |                                                                                                 |
| PostgreSQL Schema      | PostgreSQL Tool (`postgresTool`)  | Retrieves list of tables from schema | AI Agent (as AI tool)        | AI Agent                   |                                                                                                 |
| PostgreSQL Definition  | PostgreSQL Tool (`postgresTool`)  | Retrieves table column metadata    | AI Agent (as AI tool)        | AI Agent                   |                                                                                                 |
| Groq Chat Model         | Language Model Chat (`lmChatGroq`) | Generates final natural language response | AI Agent (as AI languageModel) | AI Agent                   |                                                                                                 |
| Sticky Note1            | Sticky Note                      | Guidance and customization tips    | None                        | None                       |                                                                                                 |
| Sticky Note2            | Sticky Note                      | Guidance and customization tips    | None                        | None                       |                                                                                                 |
| Sticky Note3            | Sticky Note                      | Guidance and customization tips    | None                        | None                       |                                                                                                 |
| Sticky Note             | Sticky Note                      | General guidance                   | None                        | None                       |                                                                                                 |

---

### 4. Reproducing the Workflow from Scratch

1. **Create "When chat message received" node**  
   - Type: `Chat Trigger` (`@n8n/n8n-nodes-langchain.chatTrigger`)  
   - Configure webhook (default settings) to listen for incoming chat messages.  
   - Position: (760,320) or as desired.

2. **Create "Chat History" node**  
   - Type: `Memory Buffer Window` (`@n8n/n8n-nodes-langchain.memoryBufferWindow`)  
   - Use default settings to retain last 10 messages.  
   - Position: (1100,520).

3. **Create "AI Agent" node**  
   - Type: `Agent` (`@n8n/n8n-nodes-langchain.agent`)  
   - Configure to receive chat input and memory buffer.  
   - Add external tools: link the PostgreSQL nodes (to be created) as AI tools.  
   - Set language model to Groq Chat Model node (to be created).  
   - Position: (1180,320).

4. **Create "PostgreSQL" node (Query Execution)**  
   - Type: `PostgreSQL` (`n8n-nodes-base.postgresTool`)  
   - Configure with PostgreSQL credentials.  
   - Set SQL query parameter to expression: `{{$node["AI Agent"].json.sql_query}}` to dynamically receive SQL from AI Agent.  
   - Position: (1280,520).

5. **Create "PostgreSQL Schema" node (Schema Retrieval)**  
   - Type: `PostgreSQL` (`n8n-nodes-base.postgresTool`)  
   - Configure with PostgreSQL credentials.  
   - Set SQL query to:  
     ```sql
     SELECT table_name FROM information_schema.tables WHERE table_schema = 'public';
     ```  
   - Position: (1480,520).

6. **Create "PostgreSQL Definition" node (Table Definition Retrieval)**  
   - Type: `PostgreSQL` (`n8n-nodes-base.postgresTool`)  
   - Configure with PostgreSQL credentials.  
   - Set SQL query to:  
     ```sql
     SELECT column_name, data_type FROM information_schema.columns WHERE table_name = '{{dynamic_table_name}}' AND table_schema = 'public';
     ```  
   - Use expression or parameter to dynamically supply `dynamic_table_name` from AI Agent output.  
   - Position: (1660,520).

7. **Create "Groq Chat Model" node**  
   - Type: `Groq Chat Model` (`@n8n/n8n-nodes-langchain.lmChatGroq`)  
   - Configure with Groq Chat API credentials.  
   - Use default or customized parameters for token limits, temperature, etc.  
   - Position: (920,520).

8. **Create Sticky Note nodes**  
   - Create four sticky notes for guidance and customization tips.  
   - Position them near relevant nodes for clarity (e.g., near AI Agent, Groq Chat Model).  
   - Populate content with instructions on model switching, token limits, SQL customization, and context window size.

9. **Connect nodes**  
   - Connect "When chat message received" â†’ "AI Agent" (main input).  
   - Connect "Chat History" â†’ "AI Agent" (memory input).  
   - Configure AI Agent to call "PostgreSQL", "PostgreSQL Schema", and "PostgreSQL Definition" nodes as AI tools.  
   - Configure AI Agent to use "Groq Chat Model" node as AI language model.  
   - Ensure all PostgreSQL nodes have valid credentials and can connect to your database.

10. **Set credentials**  
    - Configure PostgreSQL credentials in n8n for all PostgreSQL nodes.  
    - Configure Groq Chat API credentials in n8n for the Groq Chat Model node.

11. **Test workflow**  
    - Send a chat message through the webhook URL.  
    - Verify AI Agent generates SQL queries and calls PostgreSQL nodes.  
    - Confirm Groq Chat Model returns coherent natural language responses.  
    - Adjust sticky note guidance and node parameters as needed.

---

### 5. General Notes & Resources

| Note Content                                                                                                   | Context or Link                                                                                              |
|---------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
| Replace Groq Chat Model with OpenAI or Anthropic by updating credentials and node configuration.              | Workflow customization for alternative AI providers.                                                        |
| Adjust Chat History nodeâ€™s window size to retain more or fewer messages depending on conversation length.     | Memory management for context relevance.                                                                    |
| Customize SQL queries in PostgreSQL nodes to match your specific database schema and requirements.            | Ensures queries are compatible with your PostgreSQL setup.                                                  |
| Consult n8n Docs on AI Agents for detailed examples and advanced configurations.                              | https://docs.n8n.io/integrations/ai-agents/                                                                 |
| Embed chatbot into website using provided code snippet: [View in CodePen ðŸ¡¥](https://codepen.io/olemai/pen/RNwPdVp) | Enables easy deployment of chatbot interface on personal or company websites.                                |
| Ensure n8n version 1.50.0 or later is used for compatibility with AI Agent and Langchain nodes.               | Version requirement for stable operation.                                                                    |
| Validate PostgreSQL credentials and permissions to allow schema queries and dynamic SQL execution.            | Prevents runtime errors due to access restrictions.                                                          |

---

This document provides a comprehensive reference to understand, reproduce, and customize the "Query PostgreSQL Database with Natural Language Using Groq AI Chatbot" workflow in n8n.