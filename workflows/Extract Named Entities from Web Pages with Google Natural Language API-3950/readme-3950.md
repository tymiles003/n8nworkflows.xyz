Extract Named Entities from Web Pages with Google Natural Language API

https://n8nworkflows.xyz/workflows/extract-named-entities-from-web-pages-with-google-natural-language-api-3950


# Extract Named Entities from Web Pages with Google Natural Language API

---

### 1. Workflow Overview

This workflow automates the extraction of named entities (such as people, organizations, locations) from any web page by leveraging Google’s Natural Language API. It is designed primarily for content strategists, SEO professionals, data analysts, marketers, and researchers who need to quickly analyze web page content without manual effort.

The workflow is logically divided into the following blocks:

- **1.1 Input Reception:** Receive a URL via a webhook POST request.
- **1.2 Content Retrieval:** Fetch the HTML content of the provided URL.
- **1.3 Content Preparation:** Clean and prepare the HTML content for API consumption, including trimming large content to fit API limits.
- **1.4 Entity Extraction:** Submit the prepared HTML content to Google’s Natural Language API to perform entity analysis.
- **1.5 Response Delivery:** Send the structured entity data back as the webhook response.

---

### 2. Block-by-Block Analysis

#### Block 1.1: Input Reception

**Overview:**  
This block exposes a webhook endpoint that accepts a POST request containing a JSON body with a URL to analyze.

**Nodes Involved:**  
- Get Url (Webhook)

**Node Details:**  
- **Get Url**  
  - Type: Webhook  
  - Role: Entry point to receive the input URL for analysis.  
  - Configuration:  
    - HTTP Method: POST  
    - Path: Custom webhook path generated by n8n (`2944c8f6-03cd-4ab8-8b8e-cb033edf877a`)  
    - Response Mode: Delegates response to a downstream node (Respond to Webhook)  
  - Input: Receives raw HTTP POST request with JSON body `{ "url": "https://example.com" }`  
  - Output: Passes JSON containing the request to the next node  
  - Edge Cases & Failures:  
    - Missing or malformed JSON body  
    - URL field absent or invalid URL format  
    - HTTP method other than POST  
  - Version: v2 webhook node

---

#### Block 1.2: Content Retrieval

**Overview:**  
Using the URL provided, this block performs an HTTP GET request to fetch the full HTML content of the web page.

**Nodes Involved:**  
- Get URL Page Contents (HTTP Request)

**Node Details:**  
- **Get URL Page Contents**  
  - Type: HTTP Request  
  - Role: Retrieve raw HTML content from the target URL  
  - Configuration:  
    - URL: Dynamically set to the `url` field from the webhook JSON body (`={{ $json.body.url }}`)  
    - Method: GET (default)  
    - No additional headers or authentication  
  - Input: Receives JSON from webhook node containing the URL  
  - Output: Passes the raw HTML content as `data` in JSON format downstream  
  - Edge Cases & Failures:  
    - HTTP errors (404, 500, timeouts)  
    - Non-HTML responses or redirects  
    - Large pages causing delays or timeouts  
  - Version: v4.2 HTTP request node

---

#### Block 1.3: Content Preparation

**Overview:**  
Cleans and prepares the fetched HTML content for submission to Google’s API. It also truncates content exceeding 100,000 characters to comply with API limits.

**Nodes Involved:**  
- Respond with detected entities (Code node)

**Node Details:**  
- **Respond with detected entities**  
  - Type: Code (JavaScript)  
  - Role: Prepare the HTTP request body for Google Natural Language API by encapsulating the HTML content  
  - Configuration:  
    - JavaScript code extracts the HTML from input, trims to 100,000 chars if needed  
    - Constructs the JSON body with `document.type = "HTML"` and `content` as the trimmed HTML  
    - Sets encoding type to UTF8  
  - Key expressions:  
    ```js
    const html = $input.item.json.data;
    const trimmedHtml = html.length > 100000 ? html.substring(0, 100000) : html;
    return {
      json: {
        apiRequest: {
          document: {
            type: "HTML",
            content: trimmedHtml
          },
          encodingType: "UTF8"
        }
      }
    }
    ```
  - Input: Receives HTML content as `data` field from previous HTTP Request node  
  - Output: JSON formatted for Google API request, stored under `apiRequest`  
  - Edge Cases & Failures:  
    - HTML content missing or empty  
    - Content larger than 100,000 characters (trimmed without warning)  
    - Encoding issues if non-UTF8 content  
  - Version: v2 Code node

---

#### Block 1.4: Entity Extraction

**Overview:**  
Sends the prepared request to Google’s Natural Language API to analyze entities in the HTML content.

**Nodes Involved:**  
- Google Entities (HTTP Request)

**Node Details:**  
- **Google Entities**  
  - Type: HTTP Request  
  - Role: Perform POST request to Google Natural Language API’s `analyzeEntities` endpoint  
  - Configuration:  
    - URL: `https://language.googleapis.com/v1/documents:analyzeEntities`  
    - Method: POST  
    - Headers: Content-Type: application/json  
    - Body: JSON constructed by previous node (`={{ $json.apiRequest }}`)  
    - Query Parameter: `key` set to user’s Google API key (replace `"YOUR-GOOGLE-API-KEY"`)  
    - Send Body: JSON  
  - Input: JSON body from Code node with document content  
  - Output: Google API JSON response containing entities, types, salience, mentions  
  - Edge Cases & Failures:  
    - Invalid or missing API key (authentication error)  
    - API rate limit exceeded  
    - Invalid request format or oversized content  
    - Network issues or Google service unavailability  
  - Version: v4.2 HTTP Request node

---

#### Block 1.5: Response Delivery

**Overview:**  
Returns the structured entity data obtained from Google back to the original webhook client.

**Nodes Involved:**  
- Respond to Webhook

**Node Details:**  
- **Respond to Webhook**  
  - Type: Respond to Webhook  
  - Role: Sends the final JSON response to the POST request that initiated the workflow  
  - Configuration:  
    - No additional parameters; defaults to send incoming JSON as response  
  - Input: Receives Google API response JSON from previous node  
  - Output: Sends HTTP 200 response containing entity data  
  - Edge Cases & Failures:  
    - Potential delay leading to webhook timeout on client side  
    - Response size too large for webhook limits (rare)  
  - Version: v1.1 Respond to Webhook node

---

### 3. Summary Table

| Node Name                 | Node Type                 | Functional Role                         | Input Node(s)            | Output Node(s)          | Sticky Note                                                                                                   |
|---------------------------|---------------------------|---------------------------------------|--------------------------|-------------------------|---------------------------------------------------------------------------------------------------------------|
| Get Url                   | Webhook                   | Receive URL input via POST request    |                          | Get URL Page Contents    |                                                                                                               |
| Get URL Page Contents      | HTTP Request              | Fetch HTML content from URL            | Get Url                  | Respond with detected entities |                                                                                                               |
| Respond with detected entities | Code (JavaScript)       | Prepare JSON body for Google API       | Get URL Page Contents     | Google Entities          |                                                                                                               |
| Google Entities           | HTTP Request              | Call Google Natural Language API        | Respond with detected entities | Respond to Webhook       | Replace `"YOUR-GOOGLE-API-KEY"` with your actual Google API key                                               |
| Respond to Webhook        | Respond to Webhook        | Return entity extraction results        | Google Entities           |                         |                                                                                                               |
| Sticky Note               | Sticky Note               | Documentation and usage instructions    |                          |                         | # Google Page Entity Extraction Template... Detailed usage and input/output format explained in node comment |

---

### 4. Reproducing the Workflow from Scratch

1. **Create Webhook Node**  
   - Add a **Webhook** node named `Get Url`.  
   - Set HTTP Method to `POST`.  
   - Define a unique webhook path (e.g., `2944c8f6-03cd-4ab8-8b8e-cb033edf877a`).  
   - Set Response Mode to `Response Node` (delegates response to downstream node).  

2. **Create HTTP Request Node for Fetching URL Content**  
   - Add an **HTTP Request** node named `Get URL Page Contents`.  
   - Set Method to `GET`.  
   - Set URL parameter to `={{ $json.body.url }}` (dynamic value from webhook JSON body).  
   - Connect `Get Url` node’s output to this node’s input.

3. **Create Code Node to Prepare API Request**  
   - Add a **Code** node named `Respond with detected entities`.  
   - Use JavaScript code to:  
     - Extract HTML content from input (`$input.item.json.data`).  
     - Trim to 100,000 characters if longer.  
     - Construct a JSON object with:  
       ```json
       {
         "document": {
           "type": "HTML",
           "content": "trimmed HTML content here"
         },
         "encodingType": "UTF8"
       }
       ```  
   - Connect `Get URL Page Contents` node to this node.

4. **Create HTTP Request Node to Call Google Natural Language API**  
   - Add an **HTTP Request** node named `Google Entities`.  
   - Set Method to `POST`.  
   - Set URL to `https://language.googleapis.com/v1/documents:analyzeEntities`.  
   - Set Headers to include `Content-Type: application/json`.  
   - For Body Content, select `JSON` and set it to `={{ $json.apiRequest }}`.  
   - Add Query Parameter:  
     - Name: `key`  
     - Value: your Google API key (replace `"YOUR-GOOGLE-API-KEY"`).  
   - Connect `Respond with detected entities` node to this node.

5. **Create Respond to Webhook Node**  
   - Add a **Respond to Webhook** node named `Respond to Webhook`.  
   - No special configuration needed, defaults suffice.  
   - Connect `Google Entities` node to this node.

6. **Activate Workflow**  
   - Save and activate the workflow.  
   - Copy the webhook URL from the `Get Url` node for testing.

---

### 5. General Notes & Resources

| Note Content                                                                                                                                                                                                                                                                              | Context or Link                         |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
| This workflow respects Google API limits by processing one URL at a time. Consider batching or throttling for large-scale use.                                                                                                                                                            | Workflow design best practice          |
| Google Natural Language API may not detect all entities, especially in highly technical or specialized content.                                                                                                                                                                           | API limitation note                    |
| HTML content is truncated at 100,000 characters to comply with API limits, which may omit some data on very large pages. Adjustments can be made in the Code node if needed.                                                                                                                | Implementation detail                  |
| Replace `"YOUR-GOOGLE-API-KEY"` in the Google Entities node with your valid Google API key from Google Cloud Platform. Ensure the Natural Language API is enabled in your project.                                                                                                         | Google Cloud setup instructions       |
| Example webhook POST request body: `{"url": "https://example.com"}`. Use tools like Postman or cURL to test.                                                                                                                                                                               | Testing instructions                   |
| For advanced customization, add filters or additional nodes to process specific entity types or batch multiple URLs.                                                                                                                                                                      | Customization suggestions              |
| Workflow created and maintained by ❤️ [Hueston SEO Team](https://hueston.co)                                                                                                                                                                                                                | Project credit and branding            |

---